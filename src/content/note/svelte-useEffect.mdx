---
title: '(Svelte) useEffect 처럼 상태 구독하기'
description: ''
date: 2023-11-30 22:47:45
draft: true
tags:
  - svelte
---

> svelte에서 어떻게 react의 `useEffect` 처럼 상태를 구독할 수 있나요?

react 진영 개발자가 svelte 입문하게 된다면 던지는 단골 질문 중에 하나입니다. 하지만 시원하게 해답을 찾기 어려운데요. 공식문서에서 svelte 특유의 `reactive` 문법을 이해하고 알아서 이를 활용해야하기 때문입니다.

## 간단한 상태 구독

React에서는 `useEffect` 훅을 사용하여 컴포넌트의 상태 변화를 감지하고, 특정 상태가 변경될 때마다 부수 효과(side effects)를 실행합니다.

```js
useEffect(() => {
  console.log(name);
}, [name]);
```

Svelte에서는 [reactive statement(반응형 선언)](https://svelte.dev/docs/svelte-components#script-3-$-marks-a-statement-as-reactive)을 사용하여 유사한 기능을 구현할 수 있습니다. Svelte의 반응형 선언은 `$:` 기호를 사용하여 정의되며, Svelte 컴파일러는 표현식 안에 사용된 모든 변수를 파악하여 값이 변경될 때마다 자동으로 다시 실행됩니다.

```svelte
<script>
  $: console.log(name);

  // 여러 줄 형태
  $: {
    console.log(name);
  }

  // 즉시 실행 함수 형태
  $: (() => {
    console.log(name);
  })();
</script>
```

## 특정 상태만 구독

React는 의존성 배열을 활용하여 특정 상태에만 의존하는 부수 효과를 실행할 수 있습니다.

```js
useEffect(() => {
  console.log(state1, state2, state3);
}, [state1]);
// state1이 변경될 때만 수행된다.
```

하지만 Svelte에서는 `$:` 기호를 사용한 반응형 선언이 모든 관련 상태의 변경에 반응합니다. 즉, state1, state2, state3 중 어느 하나라도 변경되면 부수 효과가 실행됩니다.

```svelte
<script>
  $: console.log(state1, state2, state3);
  // 🚨 state1, state2, state3이 변경될 때 모두 수행된다.
</script>
```

이를 해결하기 위해, 불필요한 의존성을 `$:`에서 벗어나면 됩니다. 즉, **부수 효과를 별도로 정의**하고 의존할 상태만을 건네주면 됩니다.

```svelte
<script>
  const effect = (state1) => {
    console.log(state1, state2, state3);
  }
  $: effect(state1);
</script>
```

더 react 스럽게 작성한다면 다음과 같이 할 수 있습니다.

```svelte
<script>
  const effect = () => {
    console.log(state1, state2, state3);
  }
  $: effect(), [state1];
  // $: {
  //  effect();
  // }, [state1]
</script>
```

이 경우, `$:` 뒤에 오는 표현식은 `state1`에만 의존하므로, `state1`이 변경될 때만 effect 함수가 호출됩니다.

## 라이프 사이클 연동

```js
useEffect(() => {
  console.log(state1, state2, state3);
}, [state1]);
```

추가로 `DOM` 랜더링 이후의 값을 측정해야한다면 `tick`을 활용해야하는 점을 꼭 유의하셔야 합니다.

## 맺으면서

이렇게 Svelte에서는 `$:`를 사용한 반응형 선언을 통해 React의 useEffect와 유사한 기능을 구현할 수 있습니다. 이를 통해 상태 변화에 따른 동적인 반응을 쉽게 구현할 수 있습니다.
