---
title: '(Astro) ì „ì—­ ìƒíƒœë¥¼ ê³ë“¤ì—¬ ë‹¤í¬ëª¨ë“œ ê´€ë¦¬í•˜ê¸°'
description: 'Nano Storesë¥¼ ì‚¬ìš©í•˜ì—¬ Reactì™€ Svelte ì»´í¬ë„ŒíŠ¸ ê°„ì— ìƒíƒœë¥¼ ê³µìœ í•©ë‹ˆë‹¤.'
date: 2024-02-15 21:41:57
draft: false
tags:
  - astro
  - nanostores
  - global state
  - react
  - svelte
  - darkmode
---

import ThemeDropdownSvelte from '~/components/theme-dropdown.svelte';
import ThemeDropdown from '~/components/theme-dropdown.tsx';

ì§€ë‚œ [(Astro) ë‹¤í¬ëª¨ë“œ ì ìš©í•˜ê¸°](./astro-darkmode) ê¸€ì— ì´ì–´ì„œ, Astroì— ì „ì—­ ìƒíƒœë¥¼ ê³ë“¤ì–´ ë‹¤í¬ëª¨ë“œë¥¼ ì–´ë–»ê²Œ ì ìš©í•˜ë©´ ì¢‹ì„ì§€ ì‚´í´ë´…ì‹œë‹¤. ì•„ë˜ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê²Œ ë  ì  ì°¸ê³  ë¶€íƒë“œë ¤ìš”.

- í˜„ í…Œë§ˆë¥¼ ì „ì—­ ìƒíƒœë¡œ ê´€ë¦¬í•˜ê¸°
- í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ë„ ìƒíƒœê°€ ìœ ì§€ë˜ê¸°
- ì‚¬ìš©ì ê¸°ê¸°ì˜ í…Œë§ˆë¥¼ ë”°ë¼ê°€ëŠ” system í…Œë§ˆ ì¶”ê°€í•˜ê¸°
- React, Svelte ì»´í¬ë„ŒíŠ¸ì— ì „ì—­ ìƒíƒœ êµ¬ë…í•˜ê¸°

## Nano Stores

Astroì˜ ê°€ì¥ í° ë§¤ë ¥ ì¤‘ í•˜ë‚˜ëŠ” React, Vue, Svelte, Solid ë“± ì—¬ëŸ¬ ì›¹ í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì…ë‹ˆë‹¤. NextJSëŠ” Reactë§Œì„ ì¨ì•¼ í•˜ê³  NuxtëŠ” Vueë§Œì„ ì¨ì•¼ í•˜ê¸° ë•Œë¬¸ì´ì£ .

ê·¸ëŸ¬ë‚˜ ì´ëŸ¬í•œ ë‹¤ì–‘ì„±ì€ í”„ë¡œì íŠ¸ì˜ ìœ ì—°ì„±ì„ í–¥ìƒí•  ìˆ˜ ìˆì§€ë§Œ, ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ê°„ ê°™ì€ ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ” ìƒˆë¡œìš´ ë„ì „ ê³¼ì œë¥¼ ë˜ì ¸ì¤ë‹ˆë‹¤.
ë‹¤í–‰íˆ [Astro ê³µì‹ë¬¸ì„œ](https://docs.astro.build/en/recipes/sharing-state)ì—ì„œ ì´ì— ì í•©í•œ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ [**Nano Stores**](https://github.com/nanostores/nanostores#nano-stores)ë¥¼ ì†Œê°œí•´ì¤ë‹ˆë‹¤.

[**Nano Stores**](https://github.com/nanostores/nanostores#nano-stores)ëŠ” ì´ë¦„ëŒ€ë¡œ "**ì•„ì£¼ ì‘ì€ ì €ì¥ì†Œ**"ì…ë‹ˆë‹¤.
ì‘ì€ ìš©ëŸ‰(298 bytes)ì„ ìë‘í•˜ë©° Recoil, Jotaiì™€ ìœ ì‚¬í•œ `atomic` ê°œë…ì„ ì°¨ìš©í•˜ì—¬ ì‰½ê²Œ ìƒíƒœë¥¼ ë‹¤ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¶”ê°€ë¡œ Nano StoresëŠ” ì•„ë˜ì™€ ê°™ì´ ìì‹ ì˜ ì •ì²´ì„±ì„ ì†Œê°œí•©ë‹ˆë‹¤.

> **Nano Stores was created to move logic from components to the store.**

ì „ì—­ ìƒíƒœëŠ” ì–´ë””ì„œë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì  ë•Œë¬¸ì— ì½”ë“œ íŒŒí¸í™”ë¡œ ì‰½ê²Œ ê³ í†µì„ ë°›ëŠ”ë°ìš”. ë§Œì•½ ìƒíƒœ ê´€ë ¨ëœ ëª¨ë“  ë¡œì§ì„ `store.ts` í•œ íŒŒì¼ì—ì„œ ë‹¤ë£¨ê²Œ ëœë‹¤ë©´ ë¬´ì²™ ì¾Œì í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ëŸ¼ ì´ë¥¼ í™œìš©í•˜ì—¬ ë‹¤í¬ëª¨ë“œ í…Œë§ˆ ìƒíƒœë¥¼ ë‹¤ë¤„ë³´ë„ë¡ í•©ì‹œë‹¤.

## ì „ì—­ ìƒíƒœ ì„ ì–¸í•˜ê¸°

ë¨¼ì €, ì‚¬ìš©í•  ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.

```shell
bun add nanostores @nanostores/persistent @nanostores/react
```

`nanostores`ëŠ” ìƒíƒœ ê´€ë¦¬ ì½”ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.
`@nanostores/persistent`ëŠ” localStorageë‚˜ sessionStorageë¥¼ í™œìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ë„ ìƒíƒœê°€ ìœ ì§€ë˜ë„ë¡ ë„ì™€ì¤ë‹ˆë‹¤.
`@nanostores/react`ëŠ” Reactì—ì„œ ìƒíƒœì— ë”°ë¼ ë¦¬ëœë”ë§ ë˜ë„ë¡ í•˜ëŠ” í›…ì„ ì œê³µí•´ì¤ë‹ˆë‹¤.
&nbsp;

Nano Storesë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ íŠ¹ë³„í•œ ì„¸íŒ…ì€ ì—†ìŠµë‹ˆë‹¤. ê·¸ì € ìƒíƒœë¥¼ ì„ ì–¸í•˜ê³  ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
ì €ëŠ” í…Œë§ˆë¥¼ ì‰½ê²Œ ë‹¤ë£¨ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ìƒìˆ˜ ë° íƒ€ì…ì„ ì„¸íŒ…í–ˆìŠµë‹ˆë‹¤.

```ts title="libs/stores/theme.ts" {14-17}
import { persistentAtom } from '@nanostores/persistent';

export const THEME_MAP = {
  light: 'light',
  dark: 'dark',
  system: undefined,
} as const;

export type ThemeKey = keyof typeof THEME_MAP;
export type ThemeValue = (typeof THEME_MAP)[ThemeKey];

export const STORAGE_THEME_KEY = 'theme' as const;

export const themeStore = persistentAtom<ThemeValue>(
  STORAGE_THEME_KEY,
  THEME_MAP.system,
);
```

## ì „ì—­ ìƒíƒœ êµ¬ë…í•˜ê¸°

`themeStore`ê°€ ë³€ê²½ë  ë•Œ,
ìƒíƒœì— ë”°ë¼ `<html>` íƒœê·¸ì— `.dark` í´ë¦¬ìŠ¤ë¥¼ ì²¨ì‚­í•˜ë©´ ë©ë‹ˆë‹¤.

`themeStore.subscribe` ë©”ì†Œë“œë¥¼ í™œìš©í•˜ì—¬ ì´ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts title="libs/stores/theme.ts" {12-14}
// ...

const initThemeStoreSubscribe = () => {
  const applyTheme = (theme: ThemeValue) => {
    if (theme === THEME_MAP.dark) {
      document.documentElement.classList.add('dark');
    } else if (theme === THEME_MAP.light) {
      document.documentElement.classList.remove('dark');
    }
  };

  themeStore.subscribe((theme) => {
    applyTheme(theme);
  });
};
```

ì—¬ê¸°ì„œ `system` ìƒíƒœì¼ ë•,
ì‚¬ìš©ì ê¸°ê¸°ì˜ í…Œë§ˆì— ë”°ë¼ ë‹¤í¬ëª¨ë“œê°€ ì ìš©ë˜ëŠ” ë¡œì§ë„ ì¶”ê°€í•©ë‹ˆë‹¤.

```ts title="libs/stores/theme.ts" /mediaQuery/
const initThemeStoreSubscribe = () => {
  // ...

  const handleMediaQuery = (query: { matches: boolean }) => {
    applyTheme(query.matches ? 'dark' : 'light');
  };

  themeStore.subscribe((theme) => {
    if (theme !== THEME_MAP.system) {
      applyTheme(theme);
      return;
    }

    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
    // EventListenerê°€ ì¤‘ë³µ ë“±ë¡ë˜ì§€ ì•Šë„ë¡ ì œê±° í›„ ë“±ë¡í•©ë‹ˆë‹¤.
    mediaQuery.removeEventListener('change', handleMediaQuery);
    mediaQuery.addEventListener('change', handleMediaQuery);
    handleMediaQuery(mediaQuery);
  });
};
```

&nbsp;

í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆì„ ë•Œ `initThemeStoreSubscribe` í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ ë˜ëŠ”ë°ìš”.

Nano Storeì˜ [`onMount`](https://github.com/nanostores/nanostores?tab=readme-ov-file#lazy-stores)ë¥¼ í™œìš©í•˜ë©´ ë¬´ì²™ ì‰½ìŠµë‹ˆë‹¤.
Storeê°€ ì‹¤ì œë¡œ UIì—ì„œ ì‚¬ìš©í•˜ê²Œ ë  ë•Œ `mount` ë˜ë©´ì„œ ê´€ë ¨ ë¡œì§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

```ts title="libs/stores/theme.ts"
import { onMount } from 'nanostores';

// SSRì—ì„œëŠ” ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
if (typeof window !== 'undefined') {
  onMount(themeStore, initThemeStoreSubscribe);
}
```

&nbsp;

ë§Œì•½ `onMount`ê°€ ë„ˆë¬´ ë§ˆë²•ì²˜ëŸ¼ ëŠê»´ì ¸ **ì§ì ‘ ìƒíƒœ êµ¬ë…ì´ ë“±ë¡ë˜ëŠ” ì‹œì ì„ ë‹¤ë£¨ê³  ì‹¶ë‹¤ë©´**, ì•„ë˜ì™€ ê°™ì´ ì‘ì—…í•˜ë©´ ë©ë‹ˆë‹¤.

```astro title="theme-footer-script.astro"
<script>
  import { initThemeStoreSubscribe } from '~/libs/stores/theme';

  initThemeStoreSubscribe();
</script>
```

```astro title="main.astro"
---
// ...
import ThemeFooterScript from '~/components/theme-footer-script.astro';
---

<html>
  <!-- ... -->
  <body>
    <!-- ... -->
    <ThemeFooterScript />
  </body>
</html>
```

`ThemeFooterScript`ë¥¼ body ìµœí•˜ë‹¨ì— ìœ„ì¹˜ì‹œí‚¤ë©´, í˜ì´ì§€ê°€ ë¡œë“œëœ ì‹œì ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë  ê²ƒì…ë‹ˆë‹¤. Astroê°€ ì•Œì•„ì„œ ì´ë¥¼ ë³„ë„ì˜ ëª¨ë“ˆ ë²ˆë“¤ë¡œ ìµœì í™”í•´ì¤ë‹ˆë‹¤.

## React

Astroì—ì„œ React ì„¸íŒ…í•˜ëŠ” ë°©ë²•ì€ [@astrojs/react](https://docs.astro.build/en/guides/integrations-guide/react/)ì„ ì°¸ê³ í•˜ê¸¸ ë°”ëë‹ˆë‹¤.

Reactì—ì„œ Nano Storesë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ìƒê°ë³´ë‹¤ ë‹¨ìˆœí•©ë‹ˆë‹¤.

ìƒíƒœë¥¼ ì‚¬ìš©í•  ë•, `@nanostores/react`ì—ì„œ ì œê³µí•´ì£¼ëŠ” `useStore` í›…ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
ìƒíƒœë¥¼ ìˆ˜ì •í•  ë•, `themeStore.set`ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

Preactì—ì„œë„ ë˜‘ê°™ì´ ì ìš© ë©ë‹ˆë‹¤.

```tsx title="theme-dropdown.tsx" {6, 13, 16}
import { useStore } from '@nanostores/react';
// ...
import { THEME_MAP, themeStore } from '~/libs/stores/theme';

export default function ThemeDropdown() {
  const theme = useStore(themeStore);

  return (
    <DropdownMenu>
      {/* ... */}
      <DropdownMenuItem
        className="justify-between"
        onClick={() => themeStore.set(THEME_MAP.system)}
      >
        System
        {theme === THEME_MAP.system && <DotIcon />}
      </DropdownMenuItem>
    </DropdownMenu>
  );
}
```

[ì½”ë“œ ì›ë³¸ ë³´ê¸°](https://github.com/bepyan/bepyan.me.v2/tree/main/src/components/theme-dropdown.tsx)

## Svelte

Astroì—ì„œ Svelte ì„¸íŒ…í•˜ëŠ” ë°©ë²•ì€ [@astrojs/svelte](https://docs.astro.build/ko/guides/integrations-guide/svelte/)ì„ ì°¸ê³ í•˜ê¸¸ ë°”ëë‹ˆë‹¤.

Nano StoreëŠ” Svelteì˜ [`reactive`](https://svelte.dev/docs/svelte-components#script-4-prefix-stores-with-$-to-access-their-values) ë¬¸ë²•ê³¼ í˜¸í™˜ì´ ë©ë‹ˆë‹¤.
ë³„ë‹¤ë¥¸ ì„¸íŒ… ì—†ì´ Store ì•ì— `$`ë¥¼ ë¶™ì—¬ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```svelte title="theme-dropdown.svelte" {9, 15}
<script>
  import { THEME_MAP, themeStore } from '~/libs/stores/theme';

  let isDropdownOpen = false;

  // ...

  const handleItemClick = (theme) => {
    $themeStore = theme;
    isDropdownOpen = false;
  };
</script>

<div>
  {$themeStore}
</div>
<div>
  {#each Object.keys(THEME_MAP) as themeKey}
    <button on:click={() => handleItemClick(THEME_MAP[themeKey])}>
      {themeKey}
    </button>
  {/each}
</div>
```

[ì½”ë“œ ì›ë³¸ ë³´ê¸°](https://github.com/bepyan/bepyan.me.v2/tree/main/src/components/theme-dropdown.svelte)

## ë§ºìœ¼ë©´ì„œ

ì´ì œ, ì•ì„œ ë§Œë“  ì»´í¬ë„ŒíŠ¸ë¥¼ ê°™ì´ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì–´ë–¨ê¹Œìš”?

<div class="relative z-10 flex items-center gap-2">
  <div class="text-center">
    React
    <ThemeDropdown client:load />
  </div>
  <div class="text-center">
    Svelte
    <ThemeDropdownSvelte client:load />
  </div>
</div>

ë¬¸ì œ ì—†ì´ ìƒíƒœê°€ ì˜ ë™ê¸°í™”ë˜ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤ âœ¨

&nbsp;

ì‚¬ì‹¤ [`Zustand`](https://github.com/pmndrs/zustand?tab=readme-ov-file#using-zustand-without-react)ë„ ì—¬ëŸ¬ í”„ë ˆì„ì›Œí¬ì—ì„œ ê°™ì€ ìƒíƒœë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ë°ìš”.
í•˜ì§€ë§Œ ê³µì‹ë¬¸ì„œ ê°€ì´ë“œê°€ ë¶€ì¡±í•˜ê³ , ì§ì ‘ í”„ë ˆì„ì›Œí¬ì— ë§ì¶° ë°‘ ì‘ì—…ì„ í•´ì•¼ í•œë‹¤ëŠ” ì ì´ ì•„ì‰½ìŠµë‹ˆë‹¤.

ë°˜ë©´ì— **Nano Stores**ëŠ” ê³µì‹ë¬¸ì„œ ê°€ì´ë“œë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ í”„ë ˆì„ì›Œí¬ì— ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ë§¤ë ¥ì ìœ¼ë¡œ ë‹¤ê°€ì˜¤ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ê·¸ ì™¸ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°€ë³ê³ , ì½”ë“œê°€ ì§§ì€ ì . ìƒíƒœ ë¡œì§ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìŠ¤í† ì–´ë¡œ ê°€ì ¸ì˜¤ë ¤ëŠ” ì² í•™ì´ ë¬´ì²™ ë§ˆìŒì— ë“­ë‹ˆë‹¤. íŠ¹íˆ `onMount` ê¸°ëŠ¥ì€ ì œê²Œ ì•„ì£¼ íŒŒê²©ì ìœ¼ë¡œ ë‹¤ê°€ì™”ìŠµë‹ˆë‹¤.

ì—¬ëŸ¬ë¶„ì€ ì–´ë– ì…¨ë‚˜ìš”?
ê°œì¸ì ìœ¼ë¡  ì•ìœ¼ë¡œ ê¸°íšŒê°€ ëœë‹¤ë©´ Nano Storesë¥¼ ë” ë§ì´ í™œìš©í•´ë³´ê³  ì‹¶ìŠµë„¤ìš” ğŸ¥°
